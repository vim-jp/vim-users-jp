---
layout: post
title: "Hack #10: バッファとウィンドウ"
date: 2009-05-13
author: thinca
---
<p>
				Vim を使う上で重要な概念として、バッファとウィンドウがあります。本 Hack ではこれらについてその概要を見ていきます。
</p>

<h3>バッファ</h3>

<p>
				バッファは、ファイルを編集するための論理的な領域です。Vim で新しくファイルを開くと、新しいバッファが作成されてそこにファイルの内容が読み込まれます。
</p>

<p>
				Vim は起動してから開いたファイル(正確にはバッファ)を(明示的にバッファを削除しない限り)全て覚えています。
				別のファイルを編集するために現在のバッファを閉じたとしても、閉じたバッファはバッファリストに記憶されていて、後から簡単に開き直すことができます。
</p>

<h4>バッファの要素</h4>

<p>
				全てのバッファには番号と名前が付けられて、どちらもバッファを開くときなどバッファを選択する際に利用できます。
</p>

<dl>
<dt>バッファ番号</dt>
<dd>
				  バッファには作成された順に 1 から順に一意のバッファ番号が振られます。バッファ番号はすでにあるバッファを削除したとしても決して再利用されることはありません。
</dd>
<dt>バッファ名</dt>
<dd>
				  バッファ名は、バッファが編集しているファイル名です。ただし、
<ul>
<li>ファイル名を指定せずに開いたバッファ (無名バッファ)</li>
<li>仮想的なパス(ftp://など)</li>
<li>編集や保存が目的ではないバッファ(<a class="hack" href="/vim-users-jp/2009/05/hack7/">Hack #7: 編集中ファイルを実行し、結果を表示したままにする</a> の出力結果を表示するためのバッファなど)</li>
</ul>
				  などの場合もあります。いずれにしてもバッファ名であると言うことに変わりはありません。このように実際のファイル名ではない場合、保存処理をVimスクリプトで置き換えたり保存自体を禁止したりしてあります。
</dd>
<dd>
				  新しくバッファを開こうとした際、すでに同名のバッファがあった場合は新しいバッファを作らず既存のバッファが開かれます。これにより同名のバッファが複数作成されることはありません。ただし無名バッファだけは特別で複数作ることができます。
</dd>
</dl>

<h4>バッファの状態</h4>

<p>
				バッファには 3 つの状態があります。
</p>

<dl>
<dt>active</dt>
<dd>バッファがいずれかのウィンドウに表示されています。バッファには編集作業用のメモリが割り当てられています。</dd>
<dt>hidden</dt>
<dd>バッファはどのウィンドウにも表示されていませんが、メモリは割り当てられています。</dd>
<dt>inactive</dt>
<dd>ウィンドウに表示されておらず、メモリも割り当てられていません。</dd>
</dl>

<p>
				実は、Vim 上の全てのバッファに対して常にメモリが割り当てられているわけではありません。
				ウィンドウに表示されていないバッファはそのファイルの内容を一切記憶していません。再びバッファを表示する際に自動的に読み込まれます。
				これにより、大量のファイルを開いても Vim が余計にメモリを使いすぎることはありません。
				保存していないバッファを閉じることができず、強制的に閉じると変更が失われるのはこういった理由からです。
</p>

<p>
				ただし、時には編集中の状態を保存せずに閉じたい事もあります。そのために hidden 状態が用意されています。この状態にするには <code class="vim-option">'hidden'</code> オプション、<code class="vim-option">'bufhidden'</code> オプション、 <code class="lang-vim">:hide</code> コマンドを使用します。
</p>

<h3>ウィンドウ</h3>

<p>
				ウィンドウはバッファを画面に表示するための物理的な領域です。ウィンドウにはバッファの一部(もしくは全体)が表示されます。
				ウィンドウには必ず何かしらのバッファの内容が表示されています。例えば、引数を指定せずに Vim を起動すると無名バッファが表示されたウィンドウが表示されます。
</p>

<h4>ウィンドウの分割</h4>

<p>
				ウィンドウは分割することで複数のウィンドウを 1 つの画面に同時に表示することができます。これは、複数のファイルを同時に表示できるだけでなく、1 つのファイルの複数の箇所を同時に表示できることを意味します。
				ウィンドウは垂直方向もしくは水平方向に表示領域の許す限り任意の回数分割できます。水平分割してから垂直分割、のように織り交ぜての分割も可能です。
</p>

<p><img style="width: 80%" src="http://gyazo.com/457ad3f18e9a25eea0ffd035897915ab.png" alt="ウィンドウを分割した Vim" /></p>

<h4>ウィンドウ番号</h4>

<p>
				ウィンドウには識別のために 1 から順に番号が振られます。ただしバッファ番号と違い、ウィンドウが閉じられれば番号は詰められウィンドウの位置が入れ替えられれば番号も位置に応じて振り直されます。ウィンドウ番号の数は常に 1 ～ (ウィンドウ数) です。
</p>

<h3>まとめ</h3>

<p>
				バッファとウィンドウについて、基本的な部分だけ解説しました。基本のみに絞ったのでやや中途半端になってしまった部分もありますが、バッファとウィンドウに関する事柄は大量にあるのでここだけではとても紹介しきれません。Vim の中核となる要素なので、正しく理解しておく必要があります。
</p>

<address class="hack-author">thinca</address>
