---
layout: post
category: vimusersjp
title: Hack #65:#58; 選択範囲を検索する
date: 2009-08-31
author: thinca
---
<p>バッファ全体ではなく、範囲を制限して部分的に検索を行いたいことがあります。Vim にはそれを行うための正規表現の構文があります。</p>

<h2>\%V</h2>

<p>\%V は、選択した範囲にマッチする正規表現です。
つまり、検索パターン中に \%V を含めると、直前に選択した範囲にのみ検索がマッチするようになります。
Vim はウィンドウ毎に直前に選択された範囲を覚えているので、 Normal mode で使用した場合は直前の範囲が使用されます。</p>

<p>よって、選択範囲を検索するには</p>

<ul>
<li>Visual mode に入って検索したい範囲を選択する。</li>
<li>Visual mode を抜け、/ で検索プロンプトを出す。</li>
<li>\%V を入力してから検索したい文字列を入力する。</li>
</ul>

<p>とします。</p>

<p>検索のハイライトも選択範囲のみがハイライトされるので、目的の箇所が探しやすくなります。
また、新しく Visual mode で範囲を選択するとマッチする箇所も変更されます。</p>

<h2>設定例</h2>

<p>頻繁に使うようなら Key mapping を設定しておくと良いでしょう。</p>

<pre><code>vnoremap z/ &lt;ESC&gt;/\%V
vnoremap z? &lt;ESC&gt;?\%V
</code></pre>

<p>Visual mode 中に検索による移動ができなくてもよいのなら、/ や ? を直接上書きするようにマッピングしても構いません。</p>

<address class="hack-author">thinca</address>
