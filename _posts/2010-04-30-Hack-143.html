---
layout: post
title: "Hack #143: 見た目を変えずにタブ文字とスペースを相互に変換する"
date: 2010-04-30
author: thinca
---
<p>プログラムのインデントには昔からスペース派とタブ派があり、どちらを使うかは個々人の好みによりますが、自分の流派と違うファイルを編集することになったとき、場合によっては自分の好みのインデント方式に変えたいこともあるでしょう。</p>

<p>行頭のインデントは置換で済んでしまうことも多いですが、それ以外の場所はタブの幅がまちまちで単純な置換は難しいこともあります。</p>

<h3>:retab</h3>

<p><code>:retab</code> コマンドを使うことで、見た目を変えずにタブ文字の幅を変えたりタブ文字とスペースを相互に変換することができます。</p>

<h3>タブ幅を変える</h3>

<p><code>:retab</code> コマンドを、新しい &#8216;tabstop&#8217; の値を引数に指定して実行することで、タブ文字を含む連続した空白を新しいタブ幅で置き換えます。この時、&#8217;tabstop&#8217; の値は指定した値に設定されます。新しいタブ幅でタブ文字で表現しきれない部分はスペースが使われます。</p>

<p>例: tabstop=8 (タブ文字を &gt;&#8212;&#8212;- で、インデント中のスペースを _ で表示しています)</p>

<pre><code>int main(int argc, char const* argv[]) {
&gt;--------int&gt;---count&gt;--= 0;
&gt;--------char&gt;--ch&gt;-----= '0';
}
</code></pre>

<p>この状態で</p>

<pre><code>:retab 3
</code></pre>

<p>を実行すると、</p>

<pre><code>int main(int argc, char const* argv[]) {
&gt;--&gt;--__int&gt;&gt;--_count&gt;--= 0;
&gt;--&gt;--__char&gt;--_ch&gt;--&gt;--= '0';
}
</code></pre>

<p>となります。</p>

<p>このコマンドには<a href="/vim-users-jp/2009/06/hack30/">範囲を与えることができます</a>が、その場合でも <code class="option">'tabstop'</code> の値は変更されるので範囲外の見た目が変わることになります。</p>

<h3>タブ文字をスペースに変換する</h3>

<p><code class="option">'expandtab'</code> がオンの時にこのコマンドを使うと、結果はスペースで置き換えられます。この場合引数を与えることもできますが、<code class="option">'tabstop'</code> の値を変更する以上の意味はありません。</p>

<h3>スペースをタブ文字に変換する</h3>

<p><code>:retab</code> コマンドは「タブ文字を含む」連続した空白を置き換えるので通常スペースのみの部分は置き換えられません。しかし、! を付けた <code>:retab!</code> を使えばスペースのみの部分もタブ文字に置き換えてくれます。</p>

<p>ただし、この場合意図しない箇所、例えば文字列リテラル中の空白も置き換えられてしまうので注意が必要です。その場合は <code>:substitute</code> による行頭部分の置換の方が良いかもしれません。</p>

<pre><code>%s@^\v(%( {4})+)@\=repeat(&quot;\t&quot;, len(submatch(1))/4)@
</code></pre>

<address class="hack-author">thinca</address>
